const express = require('express');
const router = express.Router();
const User = require('../models/users');

//gets ALL USERS
router.get('/', async (req, res) => {
    try{
        const allUsers = await User.find();
        res.json(allUsers);
    } catch(err){
        res.json({message:err});
    }
});

//gets specific user info
router.get('/:userID', async (req, res) => {
    try {
        const foundUser = await User.findById(req.params.userID)
        res.json(foundUser);
    } catch(err){
        res.json({message:err});
    }
});

//creates a new user
router.post('/users', async (req, res) => {

    const newUser = new User({
        firstName: req.body.firstName,
        lastName: req.body.lastName,
        email: req.body.email,
        cart: [{}]
    });

    try {
        const savedUser = await newUser.save();
        res.json(savedUser);
    } catch(err){
        res.status(404);
    }

    });

//delete all items in the users cart
router.delete('/:userID/cart', (req, res) => {
    const user = users.find(c => c.id === parseInt(req.params.userID));
    if (!user) res.status(404).send('User with given ID was not found');
    const cartTarget = user.cart;

    const cartID = carts.indexOf(cartTarget);
    carts[cartID].cartItems.splice(cartID, carts[cartID].cartItems.length);

    console.log(cartID);
    res.send(cartTarget);
});

//gets specific user's cart
router.get('/:userID/cart', (req, res) => {
    const user = users.find(c => c.id === parseInt(req.params.userID));
    const cart = user.cart;
    if (!user) res.status(404).send('Cart could not be found');
    res.send(cart);
});

module.exports = router;
