const StoreItem = require('../models/carts');
const router = express.Router();



//posts a new cart item in a specific cart
router.post('/:cartID/cartItem', async (req, res) => {
    const storeItems = await StoreItem.find({});
    const targetCart = await User.findById(req.params.cartID)
    const assignedItem = storeItems[Math.floor(Math.random()*storeItems.length)];

    const newCartItem = new CartItem({
        product: assignedItem,
        quantity: req.body.quantity
    });

    try {
        targetCart.cart.push(newCartItem);
        targetCart.save();
        res.send(targetCart);
    } catch(err){
        res.status(404);
    }
});

//delete speicific item from specific cart
router.delete('/:CartID/cartItem/:cartItemID', (req, res) => {
    const cartTarget = carts.find(c => c.cartID === parseInt(req.params.CartID));
    if (!cartTarget) res.status(404).send('Whoa that cart does not exist');

    const itemTarget = cartTarget.cartItems.find(c => c.itemID === parseInt(req.params.cartItemID));
    if (!itemTarget) res.status(404).send('Whoa that cart item does not exist');

    const deleteItemIndex = cartTarget.cartItems.indexOf(itemTarget);
    cartTarget.cartItems.splice(deleteItemIndex, 1);

    console.log(itemTarget)
    res.send(itemTarget);
});




module.exports = router;
